# 初期データシード

## 概要

このプロジェクトでは、開発環境でのテストおよび本番環境の初期セットアップのために、初期データシードスクリプトを提供しています。

## シードデータの内容

### 1. ロールマスタ (4つのロール)

| ロールコード | ロール名 | 説明 |
|-------------|----------|------|
| GENERAL | 一般ユーザー | 基本的な業務操作を行う一般ユーザー |
| APPROVER | 承認者 | 仕訳の承認権限を持つユーザー |
| MANAGER | 責任者 | マスタデータの管理権限を持つ責任者 |
| ADMIN | システム管理者 | システム全体の管理権限を持つ管理者 |

### 2. 初期管理者ユーザー

| ユーザーコード | ユーザー名 | メールアドレス | ロール |
|---------------|-----------|---------------|-------|
| ADMIN001 | システム管理者 | admin@example.com | ADMIN |
| MGR001 | 管理責任者 | manager@example.com | MANAGER |
| USER001 | 一般ユーザー | user@example.com | GENERAL |

**デフォルトパスワード**: `password123`

⚠️ **重要**: 本番環境では必ずパスワードを変更してください。

### 3. その他のマスタデータ

- **税区分マスタ**: 消費税10%、軽減税率8%、非課税・免税、税抜処理用
- **勘定科目マスタ**: 現金、普通預金、売掛金、買掛金、売上高、仕入高等の基本科目
- **取引先マスタ**: サンプルの得意先、仕入先、銀行データ
- **分析コードマスタ**: 部門、プロジェクトの分析コード

## 実行方法

### 開発環境

```bash
# すべての初期データを投入
bun run seed:init

# 個別投入（従来のスクリプト）
bun run seed:master    # マスタデータのみ
bun run seed:samples   # サンプル仕訳データ
```

### 本番環境

1. データベースの準備
```bash
bunx prisma db push    # スキーマをデータベースに適用
```

2. 初期データ投入
```bash
bun run seed:init
```

3. **セキュリティ設定（必須）**
   - 各ユーザーのパスワードを変更
   - 本番用のメールアドレスに変更
   - 不要なサンプルユーザーを削除または無効化

## セキュリティ上の注意点

### 本番環境での必須作業

1. **パスワード変更**
   - デフォルトパスワード (`password123`) は開発環境専用
   - 本番環境では強力なパスワードに変更必須

2. **メールアドレス変更**
   - `@example.com` のメールアドレスを実際のものに変更

3. **ユーザー管理**
   - 不要なサンプルユーザーの削除
   - 実際の組織に合わせたユーザー・ロール設定

4. **環境変数の確認**
   - データベース接続情報の確認
   - 本番環境用の設定ファイル使用

## スクリプトファイル

- `/scripts/seed-initial-data.ts`: 統合初期データシード（推奨）
- `/scripts/seed-master-data.ts`: 従来のマスタデータシード
- `/scripts/seed-sample-journals.ts`: サンプル仕訳データ
- `/scripts/seed-tax-rates.ts`: 税区分マスタのみ

## トラブルシューティング

### よくあるエラー

1. **"The table does not exist" エラー**
   ```bash
   bunx prisma db push
   bunx prisma generate
   ```

2. **重複エラー**
   - `skipDuplicates: true` により重複データは自動的にスキップされます
   - 既存データがある場合は安全に再実行可能

3. **パスワードハッシュエラー**
   - bcryptライブラリが正しくインストールされているか確認
   ```bash
   bun add bcrypt @types/bcrypt
   ```

## 開発者向け情報

### シードデータの追加・変更

新しいマスタデータやユーザーを追加する場合は、`/scripts/seed-initial-data.ts` を編集してください。

### データベースリセット

完全にデータベースをリセットする場合:
```bash
bunx supabase db reset  # Supabase環境
# または
bunx prisma db push --force-reset  # 他のPostgreSQL環境
```