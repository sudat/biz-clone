# Biz Clone プロジェクト概要

## プロジェクトについて

**Biz Clone** は、現代的な技術スタックを使用して構築された**会計システム**です。  
企業の仕訳入力、勘定科目管理、取引先管理などの基本的な会計業務をデジタル化することを目的としています。

## 技術スタック

### フロントエンド

- **Next.js 15.3.3** - React 基盤のフルスタックフレームワーク
- **React 19** - ユーザーインターフェース構築
- **TypeScript** - 型安全な開発
- **Tailwind CSS** - スタイリング
- **Shadcn/UI** - UI コンポーネントライブラリ
- **Radix UI** - アクセシブルなプリミティブコンポーネント

### バックエンド・データベース

- **Supabase** - BaaS（Backend as a Service）
- **PostgreSQL** - データベース
- **Prisma** - ORM（Object-Relational Mapping）
- **Zod** - スキーマ検証

### 開発・テスト

- **Playwright** - E2E テスト
- **ESLint** - コード品質チェック
- **Bun/npm** - パッケージ管理

## プロジェクトの特徴

### 1. 会計業務のデジタル化

- 仕訳入力・管理
- 勘定科目マスタ管理
- 補助科目管理
- 取引先マスタ管理
- 分析コード管理

### 2. 現代的なアーキテクチャとは何か？

**現代的なアーキテクチャ**とは、昔のシステム開発の問題を解決するために生まれた設計手法です。

#### 昔のシステムの問題点

- **スパゲッティコード**: すべてのコードが絡み合っていて、修正すると予期せぬところでバグが発生
- **テストが困難**: コードが密結合していて、部分的なテストができない
- **機能追加が困難**: 新機能を追加するたびに既存コードを大幅に修正する必要がある

#### 現代的なアーキテクチャの解決策

**レイヤードアーキテクチャ（4 層構造）**

```
プレゼンテーション層 ← ユーザーが見る画面
     ↓
アプリケーション層 ← 業務の流れを制御
     ↓
ドメイン層 ← ビジネスルールを定義
     ↓
インフラ層 ← データベースとの接続
```

**Repository パターン**

- データベースへのアクセス方法を統一化
- 「勘定科目を取得する」という処理を、データベースの詳細を知らなくても使える

**Service 層によるビジネスロジック分離**

- 「新しい勘定科目を作成する」などの業務ロジックを独立させる
- 画面から独立しているので、API でも Web 画面でも同じロジックを使える

**型安全性**

- TypeScript により、間違ったデータ型を使うとコンパイル時にエラーになる
- 実行前にバグを発見できる

### 3. スケーラブルな設計とは何か？

**スケーラブル**とは、システムが成長しても対応できる設計のことです。

#### 具体的な成長パターンと対策

**ユーザー数の増加**

- **問題**: 1,000 人のユーザーが同時にアクセスしたらシステムが重くなる
- **対策**: キャッシュ機能、データベース最適化、サーバー増設が容易な設計

**機能の追加**

- **問題**: 新しい帳票機能を追加したいが、既存コードを壊しそう
- **対策**: モジュラー構造により、新機能を独立したモジュールとして追加

**開発チームの拡大**

- **問題**: 10 人の開発者が同じコードを同時に修正すると競合する
- **対策**: 依存性注入パターンにより、各開発者が独立した部分を担当可能

**データ量の増加**

- **問題**: 100 万件の仕訳データで検索が遅くなる
- **対策**: 効率的なデータアクセスパターン、インデックス最適化

#### 実装されている具体的な仕組み

**モジュラー構造による保守性**

```typescript
// 勘定科目サービスは独立しており、他の機能に影響しない
export class AccountService {
  // 勘定科目に関する処理のみを担当
}

// 取引先サービスも独立
export class PartnerService {
  // 取引先に関する処理のみを担当
}
```

**依存性注入パターン**

```typescript
// サービスは具体的なデータベースを知らない
class AccountService {
  constructor(private repository: IAccountRepository) {
    // インターフェースのみに依存
  }
}
```

**テスト可能な設計**

```typescript
// モックを使って単体テストが可能
const mockRepository = new MockAccountRepository();
const service = new AccountService(mockRepository);
// サービス単体でテストできる
```

### 4. TASK23 リファクタリングで実現した改善

最新のリファクタリング（TASK23）により、以下の改善を実現しました：

#### 統一データアクセス層の実装

- **改善前**: データアクセスのコードが各所に散らばっていた
- **改善後**: `DataAccessLayer` クラスで一元管理、どこからでも同じ方法でデータにアクセス

#### Repository パターンの完全実装

- **改善前**: データベースアクセスが直接記述されていた
- **改善後**: `BaseRepository` を継承した専用クラス（`AccountRepository`, `PartnerRepository` など）で抽象化

#### Factory パターンによる依存性管理

- **改善前**: オブジェクトの生成が各所で行われていた
- **改善後**: `RepositoryFactory`, `ServiceFactory` で統一的に管理

#### パフォーマンス最適化

- **改善前**: パフォーマンステストが不十分
- **改善後**: 型変換、キャッシュ効率、メモリ使用量の包括的テスト実装

## ディレクトリ構造の概要

```
biz-clone/
├── app/              # Next.js App Router (ページ・レイアウト)
├── components/       # 再利用可能なUIコンポーネント
├── lib/              # ビジネスロジック・データアクセス層
│   ├── data-access/  # 🆕 統一データアクセス層
│   ├── repositories/ # 🆕 Repository パターン実装
│   ├── services/     # 🆕 Service 層実装
│   └── schemas/      # バリデーションスキーマ
├── prisma/           # データベーススキーマ・マイグレーション
├── supabase/         # Supabase設定
├── __tests__/        # テストファイル
│   ├── integration/  # 🆕 統合テスト
│   └── performance/  # 🆕 パフォーマンステスト
└── types/            # TypeScript型定義
```

🆕: TASK23 で新規追加・大幅改善された部分

## 対象ユーザー

- **中小企業の経理担当者**
- **会計事務所**
- **個人事業主**

基本的な複式簿記の知識を持つユーザーを想定し、直感的で使いやすいインターフェースを提供します。

## なぜこのアーキテクチャを選んだのか？

### 会計システムの特性

1. **正確性が最重要**: 金額の計算ミスは許されない → 型安全性、テストの重要性
2. **複雑なビジネスルール**: 複式簿記、税務処理など → ドメイン層での明確な定義
3. **長期間の運用**: 会計データは何年も保持 → 保守性、拡張性の重要性
4. **監査対応**: データの整合性証明が必要 → トランザクション管理、ログ機能

### 選択したアーキテクチャの利点

- **レイヤード構造**: 各層の責務が明確で、会計の複雑さを整理
- **Repository パターン**: データの整合性を保証、監査ログの一元管理
- **Service 層**: 複雑な会計ルールを独立して管理
- **Factory パターン**: 依存関係を明確にし、テストでの検証を容易に

## 次のドキュメント

- [02\_アーキテクチャ設計.md](./02_アーキテクチャ設計.md) - システム全体のアーキテクチャ
- [03\_データベース設計.md](./03_データベース設計.md) - データベーススキーマの詳細
- [04\_フロントエンド構造.md](./04_フロントエンド構造.md) - UI・画面構成
- [05\_バックエンド構造.md](./05_バックエンド構造.md) - サービス・リポジトリ層
