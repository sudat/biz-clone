# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ§‹é€ 

## æ¦‚è¦

Biz Clone ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ Next.js 15 ã® App Router ã‚’æ¡ç”¨ã—ã€ç¾ä»£çš„ãª React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦æ§‹ç¯‰ã•ã‚Œã¦ã„ã¾ã™ã€‚  
**Shadcn/UI**ã‚’åŸºç›¤ã¨ã—ãŸãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šã€çµ±ä¸€æ„Ÿã®ã‚ã‚‹ UI ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ã‚³ã‚¢ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

- **Next.js 15.3.3** - App Router ä½¿ç”¨
- **React 19** - Server Components & Client Components
- **TypeScript** - å‹å®‰å…¨ãªé–‹ç™º

### UI ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

- **Shadcn/UI** - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **Radix UI** - ã‚¢ã‚¯ã‚»ã‚·ãƒ–ãƒ«ãªãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–
- **Tailwind CSS** - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ CSS
- **Lucide React** - ã‚¢ã‚¤ã‚³ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### çŠ¶æ…‹ç®¡ç†ãƒ»ãƒ•ã‚©ãƒ¼ãƒ 

- **React Hook Form** - ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†
- **Zod** - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **Tanstack Table** - ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
app/                      # Next.js App Router
â”œâ”€â”€ auth/                 # èªè¨¼é–¢é€£
â”‚   â””â”€â”€ callback/         # èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
â”œâ”€â”€ master/               # ãƒã‚¹ã‚¿ç®¡ç†ç”»é¢
â”‚   â”œâ”€â”€ accounts/         # å‹˜å®šç§‘ç›®ç®¡ç†
â”‚   â”œâ”€â”€ sub-accounts/     # è£œåŠ©ç§‘ç›®ç®¡ç†
â”‚   â”œâ”€â”€ partners/         # å–å¼•å…ˆç®¡ç†
â”‚   â””â”€â”€ analysis-codes/   # åˆ†æã‚³ãƒ¼ãƒ‰ç®¡ç†
â”œâ”€â”€ login/                # ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
â”œâ”€â”€ signup/               # ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ç”»é¢
â”œâ”€â”€ lib/                  # Server Actions
â”‚   â””â”€â”€ actions/          # ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†
â”œâ”€â”€ layout.tsx            # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”œâ”€â”€ page.tsx              # ãƒ›ãƒ¼ãƒ ç”»é¢
â””â”€â”€ globals.css           # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«

components/               # å†åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ ui/                   # åŸºæœ¬UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ layout/               # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ accounting/           # æ¥­å‹™ç‰¹åŒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â””â”€â”€ providers/            # Contextãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
```

## ãƒšãƒ¼ã‚¸æ§‹æˆ

### 1. ç”»é¢ãƒ•ãƒ­ãƒ¼å›³

```mermaid
flowchart TD
    A[ãƒ›ãƒ¼ãƒ ç”»é¢] --> B[ãƒ­ã‚°ã‚¤ãƒ³]
    A --> C[ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—]
    B --> D[èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯]
    C --> D
    D --> E[ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰]
    E --> F[ãƒã‚¹ã‚¿ç®¡ç†]
    F --> G[å‹˜å®šç§‘ç›®ç®¡ç†]
    F --> H[è£œåŠ©ç§‘ç›®ç®¡ç†]
    F --> I[å–å¼•å…ˆç®¡ç†]
    F --> J[åˆ†æã‚³ãƒ¼ãƒ‰ç®¡ç†]
    E --> K[ä»•è¨³å…¥åŠ›]
    E --> L[å¸³ç¥¨å‡ºåŠ›]
```

### 2. ä¸»è¦ç”»é¢

#### ãƒ›ãƒ¼ãƒ ç”»é¢ (`app/page.tsx`)

- **ç›®çš„**: ã‚·ã‚¹ãƒ†ãƒ ã®æ¦‚è¦èª¬æ˜ã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- **ç‰¹å¾´**: ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã€ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

#### èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

- **ãƒ­ã‚°ã‚¤ãƒ³** (`app/login/`)
- **ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—** (`app/signup/`)
- **ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯** (`app/auth/callback/`)
- **æŠ€è¡“**: Supabase Auth

#### ãƒã‚¹ã‚¿ç®¡ç†ç”»é¢ç¾¤ (`app/master/`)

å„ãƒã‚¹ã‚¿ç®¡ç†ç”»é¢ã¯çµ±ä¸€ã•ã‚ŒãŸæ§‹é€ ã‚’æŒã¡ã¾ã™ï¼š

```typescript
// å…±é€šã®ç”»é¢æ§‹é€ 
interface MasterPageStructure {
  list: "ä¸€è¦§è¡¨ç¤ºãƒ»æ¤œç´¢";
  create: "æ–°è¦ä½œæˆãƒ•ã‚©ãƒ¼ãƒ ";
  edit: "ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ";
  detail: "è©³ç´°è¡¨ç¤º";
}
```

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 1. UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`components/ui/`)

Shadcn/UI ãƒ™ãƒ¼ã‚¹ã®åŸºæœ¬ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼š

```
ui/
â”œâ”€â”€ button.tsx           # ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ input.tsx            # å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
â”œâ”€â”€ form.tsx             # ãƒ•ã‚©ãƒ¼ãƒ é–¢é€£
â”œâ”€â”€ table.tsx            # ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
â”œâ”€â”€ dialog.tsx           # ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ»ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
â”œâ”€â”€ select.tsx           # ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹
â”œâ”€â”€ alert-dialog.tsx     # ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
â”œâ”€â”€ avatar.tsx           # ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤º
â”œâ”€â”€ dropdown-menu.tsx    # ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”œâ”€â”€ label.tsx            # ãƒ©ãƒ™ãƒ«
â”œâ”€â”€ menubar.tsx          # ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼
â”œâ”€â”€ navigation-menu.tsx  # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”œâ”€â”€ popover.tsx          # ãƒãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼
â”œâ”€â”€ sonner.tsx           # ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥
â””â”€â”€ switch.tsx           # ã‚¹ã‚¤ãƒƒãƒ
```

### 2. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`components/layout/`)

```typescript
// ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¾‹
interface HeaderProps {
  user?: User | null;
  showNavigation?: boolean;
}

export function Header({ user, showNavigation = true }: HeaderProps) {
  // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆç­‰
}
```

### 3. æ¥­å‹™ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`components/accounting/`)

ä¼šè¨ˆã‚·ã‚¹ãƒ†ãƒ ç‰¹åŒ–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼š

```
accounting/
â”œâ”€â”€ account-selector.tsx      # å‹˜å®šç§‘ç›®é¸æŠ
â”œâ”€â”€ journal-form.tsx          # ä»•è¨³å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
â”œâ”€â”€ amount-input.tsx          # é‡‘é¡å…¥åŠ›
â”œâ”€â”€ date-picker.tsx           # æ—¥ä»˜é¸æŠ
â”œâ”€â”€ partner-selector.tsx      # å–å¼•å…ˆé¸æŠ
â””â”€â”€ analysis-code-selector.tsx # åˆ†æã‚³ãƒ¼ãƒ‰é¸æŠ
```

## çŠ¶æ…‹ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³è©³ç´°è§£èª¬

### ãªãœã“ã®çŠ¶æ…‹ç®¡ç†æ–¹å¼ã‚’é¸ã‚“ã ã®ã‹ï¼Ÿ

å¾“æ¥ã® React ã‚¢ãƒ—ãƒªã§ã¯ã€**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®çŠ¶æ…‹ç®¡ç†**ï¼ˆReduxã€Zustand ãªã©ï¼‰ãŒä¸»æµã§ã—ãŸã€‚  
ã—ã‹ã—ã€ä¼šè¨ˆã‚·ã‚¹ãƒ†ãƒ ã«ã¯ä»¥ä¸‹ã®è¦æ±‚ãŒã‚ã‚Šã¾ã™ï¼š

- **ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§**: è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒæ™‚ã«åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: é‡‘éŠ­ãƒ‡ãƒ¼ã‚¿ã¯ã‚µãƒ¼ãƒãƒ¼ã§æ¤œè¨¼ãƒ»å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: å¤§é‡ã®ä¼šè¨ˆãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«è¡¨ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹

ã“ã‚Œã‚‰ã®è¦æ±‚ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€**Server-First** ãªçŠ¶æ…‹ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### 1. Server Components vs Client Components ã®æˆ¦ç•¥çš„ä½¿ã„åˆ†ã‘

#### Server Componentsï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰ã®æ´»ç”¨

**ç”¨é€”**: ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºä¸­å¿ƒã®ç”»é¢

```typescript
// app/master/accounts/page.tsx
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
async function AccountListPage() {
  // ã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ãŒé«˜é€Ÿ
  const accounts = await getAccounts();

  return (
    <div>
      <h1>å‹˜å®šç§‘ç›®ä¸€è¦§</h1>
      {/* ã‚µãƒ¼ãƒãƒ¼ã§HTMLãŒç”Ÿæˆã•ã‚Œã‚‹ãŸã‚åˆæœŸè¡¨ç¤ºãŒé«˜é€Ÿ */}
      <AccountList accounts={accounts} />
    </div>
  );
}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:

- **åˆæœŸè¡¨ç¤ºã®é«˜é€ŸåŒ–**: ã‚µãƒ¼ãƒãƒ¼ã§ HTML ãŒç”Ÿæˆæ¸ˆã¿
- **SEO ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼**: æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ãŒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èªè­˜å¯èƒ½
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ãŒã‚µãƒ¼ãƒãƒ¼å†…ã§å®Œçµ
- **è»½é‡**: JavaScript ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå°ã•ã„

#### Client Componentsï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰ã®é™å®šåˆ©ç”¨

**ç”¨é€”**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ä¸­å¿ƒã®æ©Ÿèƒ½

```typescript
// components/accounting/AccountForm.tsx
"use client"; // æ˜ç¤ºçš„ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æŒ‡å®š

function AccountForm({ onSubmit }: Props) {
  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®çŠ¶æ…‹ç®¡ç†
  const [isLoading, setIsLoading] = useState(false);
  const [errors, setErrors] = useState<string[]>([]);

  const handleSubmit = async (data: FormData) => {
    setIsLoading(true);
    setErrors([]);

    try {
      // Server Action ã‚’å‘¼ã³å‡ºã—
      await createAccountAction(data);
    } catch (error) {
      setErrors([error.message]);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      {/* ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */}
      <AccountCodeInput
        onChange={(code) => validateCodeFormat(code)}
        disabled={isLoading}
      />

      {/* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */}
      {errors.map((error) => (
        <ErrorMessage key={error}>{error}</ErrorMessage>
      ))}

      {/* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ */}
      <Button disabled={isLoading}>
        {isLoading ? "ä½œæˆä¸­..." : "å‹˜å®šç§‘ç›®ã‚’ä½œæˆ"}
      </Button>
    </form>
  );
}
```

**ä½¿ç”¨åŸºæº–**:

- âœ… **Client Components**: ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- âœ… **Server Components**: ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€SEO ãŒé‡è¦ãªéƒ¨åˆ†

### 2. Server Actions ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹å®‰å…¨ãªçŠ¶æ…‹æ›´æ–°

#### TASK23 ã§å®Ÿè£…ã—ãŸçµ±ä¸€ Server Actions

```typescript
// app/lib/actions/master-unified.ts
"use server";

export async function createAccountAction(
  formData: FormData
): Promise<ActionResult> {
  try {
    // 1. å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡ºãƒ»å¤‰æ›
    const rawData = extractFormData(formData, accountCreateSchema);

    // 2. çµ±ä¸€ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤çµŒç”±ã§ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œ
    const dal = DataAccessLayer.getInstance();
    const { account: accountService } = dal.getServices();

    // 3. ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«æ¤œè¨¼
    const validatedData = await accountService.validateForCreate(rawData);

    // 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å®Ÿè¡Œï¼‰
    const result = await accountService.createAccount(validatedData);

    // 5. æˆåŠŸæ™‚ã¯ç”»é¢ã‚’å†èª­ã¿è¾¼ã¿ï¼ˆæœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºï¼‰
    revalidatePath("/master/accounts");

    return {
      success: true,
      data: result,
      message: "å‹˜å®šç§‘ç›®ã‚’ä½œæˆã—ã¾ã—ãŸ",
    };
  } catch (error) {
    // 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    return {
      success: false,
      error: error.message,
    };
  }
}
```

#### Server Actions ã®é‡è¦ãªåˆ©ç‚¹

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**

```typescript
// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã‹ã‚‰ã¯ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
// ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿æ“ä½œãŒã‚µãƒ¼ãƒãƒ¼ã§æ¤œè¨¼ã•ã‚Œã‚‹

export async function deleteAccountAction(accountCode: string) {
  // èªè¨¼ãƒã‚§ãƒƒã‚¯
  const user = await getCurrentUser();
  if (!user) throw new Error("æœªèªè¨¼");

  // æ¨©é™ãƒã‚§ãƒƒã‚¯
  if (!user.hasPermission("ACCOUNT_DELETE")) {
    throw new Error("æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“");
  }

  // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«æ¤œè¨¼
  const canDelete = await accountService.canDelete(accountCode);
  if (!canDelete) {
    throw new Error("ä½¿ç”¨ä¸­ã®å‹˜å®šç§‘ç›®ã¯å‰Šé™¤ã§ãã¾ã›ã‚“");
  }

  // å‰Šé™¤å®Ÿè¡Œ
  await accountService.delete(accountCode);
}
```

**ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§**

```typescript
// è¤‡æ•°ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åŒæ™‚ã«æ›´æ–°ã™ã‚‹å ´åˆã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
export async function moveAccountAction(
  accountCode: string,
  newParentCode: string
) {
  const dal = DataAccessLayer.getInstance();
  const { account: accountService } = dal.getServices();

  // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§è¤‡æ•°æ“ä½œã‚’å®Ÿè¡Œ
  await accountService.withTransaction(async (tx) => {
    // 1. è¦ªå­é–¢ä¿‚ã®æ›´æ–°
    await tx.updateParentChild(accountCode, newParentCode);

    // 2. ã‚½ãƒ¼ãƒˆé †ã®å†è¨ˆç®—
    await tx.recalculateSortOrder(newParentCode);

    // 3. ç›£æŸ»ãƒ­ã‚°ã®è¨˜éŒ²
    await tx.createAuditLog({
      action: "ACCOUNT_MOVE",
      accountCode,
      details: { newParentCode },
    });
  });
}
```

### 3. ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç†ã®æœ€é©åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³

#### React Hook Form + Zod ã«ã‚ˆã‚‹å‹å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ 

```typescript
// components/accounting/AccountForm.tsx
"use client";

function AccountForm() {
  // å‹å®‰å…¨ãªãƒ•ã‚©ãƒ¼ãƒ å®šç¾©
  const form = useForm<AccountFormData>({
    resolver: zodResolver(accountCreateSchema), // Zodã‚¹ã‚­ãƒ¼ãƒã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    defaultValues: {
      accountCode: "",
      accountName: "",
      accountType: "ASSET",
      isDetail: false,
      isActive: true,
    },
  });

  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const watchedAccountCode = form.watch("accountCode");

  useEffect(() => {
    if (watchedAccountCode.length >= 3) {
      // å‹˜å®šç§‘ç›®ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆdebounceï¼‰
      debouncedCheckDuplicate(watchedAccountCode);
    }
  }, [watchedAccountCode]);

  const onSubmit = async (data: AccountFormData) => {
    try {
      // Server Action å‘¼ã³å‡ºã—
      const result = await createAccountAction(data);

      if (result.success) {
        // æˆåŠŸæ™‚ã®å‡¦ç†
        toast.success(result.message);
        form.reset(); // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        router.push("/master/accounts"); // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      } else {
        // ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†
        toast.error(result.error);
      }
    } catch (error) {
      toast.error("äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
    }
  };

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        {/* å‹˜å®šç§‘ç›®ã‚³ãƒ¼ãƒ‰ */}
        <FormField
          control={form.control}
          name="accountCode"
          render={({ field }) => (
            <FormItem>
              <FormLabel>å‹˜å®šç§‘ç›®ã‚³ãƒ¼ãƒ‰ *</FormLabel>
              <FormControl>
                <Input {...field} placeholder="ä¾‹: 1010" maxLength={10} />
              </FormControl>
              <FormDescription>
                3-10æ–‡å­—ã®è‹±æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„
              </FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />

        {/* å‹˜å®šç§‘ç›®å */}
        <FormField
          control={form.control}
          name="accountName"
          render={({ field }) => (
            <FormItem>
              <FormLabel>å‹˜å®šç§‘ç›®å *</FormLabel>
              <FormControl>
                <Input {...field} placeholder="ä¾‹: ç¾é‡‘" maxLength={50} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        {/* ç§‘ç›®åŒºåˆ† */}
        <FormField
          control={form.control}
          name="accountType"
          render={({ field }) => (
            <FormItem>
              <FormLabel>ç§‘ç›®åŒºåˆ† *</FormLabel>
              <Select onValueChange={field.onChange} defaultValue={field.value}>
                <FormControl>
                  <SelectTrigger>
                    <SelectValue placeholder="ç§‘ç›®åŒºåˆ†ã‚’é¸æŠ" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  <SelectItem value="ASSET">è³‡ç”£</SelectItem>
                  <SelectItem value="LIABILITY">è² å‚µ</SelectItem>
                  <SelectItem value="EQUITY">è³‡æœ¬</SelectItem>
                  <SelectItem value="REVENUE">åç›Š</SelectItem>
                  <SelectItem value="EXPENSE">è²»ç”¨</SelectItem>
                </SelectContent>
              </Select>
              <FormMessage />
            </FormItem>
          )}
        />

        {/* é€ä¿¡ãƒœã‚¿ãƒ³ */}
        <Button
          type="submit"
          disabled={form.formState.isSubmitting}
          className="w-full"
        >
          {form.formState.isSubmitting ? (
            <>
              <Loader2 className="mr-2 h-4 w-4 animate-spin" />
              ä½œæˆä¸­...
            </>
          ) : (
            "å‹˜å®šç§‘ç›®ã‚’ä½œæˆ"
          )}
        </Button>
      </form>
    </Form>
  );
}
```

### 4. æœ€é©ãªçŠ¶æ…‹ç®¡ç†ã®é¸æŠæŒ‡é‡

#### çŠ¶æ…‹ã®ç¨®é¡ã¨ç®¡ç†å ´æ‰€

```typescript
// ğŸŒ ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ â†’ Server Components + Server Actions
interface ServerState {
  accounts: Account[]; // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—
  partners: Partner[]; // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—
  currentUser: User; // èªè¨¼çŠ¶æ…‹
}

// ğŸ“± ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ â†’ useState, useReducer
interface ClientState {
  isLoading: boolean; // èª­ã¿è¾¼ã¿çŠ¶æ…‹
  errors: string[]; // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  formData: FormData; // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›å€¤
  isModalOpen: boolean; // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºçŠ¶æ…‹
}

// ğŸ¨ UIçŠ¶æ…‹ â†’ CSSå¤‰æ•°, Tailwind
interface UIState {
  theme: "light" | "dark"; // ãƒ†ãƒ¼ãƒ
  sidebarOpen: boolean; // ã‚µã‚¤ãƒ‰ãƒãƒ¼çŠ¶æ…‹
  activeTab: string; // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–
}
```

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆ

**1. ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã®æœ€é©åŒ–**

```typescript
// æ‚ªã„ä¾‹: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®éåŠ¹ç‡ãªãƒ‡ãƒ¼ã‚¿å–å¾—
function BadAccountList() {
  const [accounts, setAccounts] = useState([]);

  useEffect(() => {
    fetch('/api/accounts')  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ ã‚µãƒ¼ãƒãƒ¼ â†’ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
      .then(res => res.json())
      .then(setAccounts);
  }, []);

  return <div>{accounts.map(...)}</div>;
}

// è‰¯ã„ä¾‹: Server Componentã§ã®åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿å–å¾—
async function GoodAccountList() {
  // ã‚µãƒ¼ãƒãƒ¼ â†’ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆç›´æ¥æ¥ç¶šï¼‰
  const accounts = await getAccounts();

  return <div>{accounts.map(...)}</div>;
}
```

**2. å¿…è¦æœ€å°é™ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹**

```typescript
// æ‚ªã„ä¾‹: å…¨ã¦ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ç®¡ç†
const [allAccounts, setAllAccounts] = useState([]);
const [filteredAccounts, setFilteredAccounts] = useState([]);
const [searchTerm, setSearchTerm] = useState("");

// è‰¯ã„ä¾‹: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
function AccountSearch() {
  const [searchTerm, setSearchTerm] = useState(""); // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ã¯æœ€å°é™

  return (
    <form action={searchAccountsAction}>
      <input
        name="searchTerm"
        value={searchTerm}
        onChange={(e) => setSearchTerm(e.target.value)}
      />
    </form>
  );
}
```

**3. é©åˆ‡ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**

```typescript
// Server Actions ã§ã®é©åˆ‡ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡
export async function updateAccountAction(data: AccountUpdateDto) {
  await accountService.update(data);

  // é–¢é€£ã™ã‚‹ãƒšãƒ¼ã‚¸ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–
  revalidatePath("/master/accounts"); // ä¸€è¦§ãƒšãƒ¼ã‚¸
  revalidatePath(`/master/accounts/${data.id}`); // è©³ç´°ãƒšãƒ¼ã‚¸
  revalidateTag("accounts"); // accounts ã‚¿ã‚°ã®ãƒšãƒ¼ã‚¸å…¨ã¦
}
```

ã“ã®çŠ¶æ…‹ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ä¸¡ç«‹ã—ãŸã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªä¼šè¨ˆã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

## ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

### 1. ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ

- **Primary**: ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼
- **Secondary**: ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚«ãƒ©ãƒ¼
- **Muted**: è£œåŠ©çš„ãªæƒ…å ±
- **Destructive**: ã‚¨ãƒ©ãƒ¼ãƒ»å‰Šé™¤ç³»
- **Border**: å¢ƒç•Œç·š
- **Background**: èƒŒæ™¯è‰²

### 2. ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£

- **è¦‹å‡ºã—**: `h1`ã€œ`h4`ï¼ˆGeist Sansï¼‰
- **æœ¬æ–‡**: `p`, `span`ï¼ˆGeist Sansï¼‰
- **ã‚³ãƒ¼ãƒ‰**: `code`ï¼ˆGeist Monoï¼‰

### 3. ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°

Tailwind CSS ã®ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚’æ¡ç”¨ï¼š

- `p-4`, `m-2`, `space-y-4` ãªã©

### 4. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

```css
/* ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ */
.container {
  @apply px-4 sm:px-6 lg:px-8;
}

/* ãƒ–ãƒ¬ã‚¤ã‚¯ãƒã‚¤ãƒ³ãƒˆ */
/* sm: 640px */
/* md: 768px */
/* lg: 1024px */
/* xl: 1280px */
```

## ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

### 1. Radix UI ãƒ™ãƒ¼ã‚¹

- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ
- ARIA å±æ€§è‡ªå‹•è¨­å®š

### 2. ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†

```typescript
// ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—ã®å®Ÿè£…ä¾‹
function Modal({ isOpen, onClose }: ModalProps) {
  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent>{/* è‡ªå‹•çš„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—ãŒé©ç”¨ */}</DialogContent>
    </Dialog>
  );
}
```

### 3. ã‚«ãƒ©ãƒ¼ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ

- WCAG 2.1 AA æº–æ‹ 
- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ç”»åƒæœ€é©åŒ–

```typescript
import Image from "next/image";

function Logo() {
  return (
    <Image src="/logo.png" alt="Biz Clone" width={120} height={40} priority />
  );
}
```

### 2. ã‚³ãƒ¼ãƒ‰åˆ†å‰²

```typescript
// å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
const HeavyComponent = dynamic(() => import("./HeavyComponent"), {
  loading: () => <Spinner />,
});
```

### 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

- Server Components ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- Static Generation ã§ã®é™çš„ç”Ÿæˆ
- ISR (Incremental Static Regeneration)

## ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ 

### 1. ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ

```typescript
// components/providers/theme-provider.tsx
import { ThemeProvider } from "next-themes";

export function AppThemeProvider({ children }: Props) {
  return (
    <ThemeProvider
      attribute="class"
      defaultTheme="system"
      enableSystem
      disableTransitionOnChange
    >
      {children}
    </ThemeProvider>
  );
}
```

### 2. CSS å¤‰æ•°

```css
:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --primary: 222.2 47.4% 11.2%;
  /* ... */
}

.dark {
  --background: 222.2 84% 4.9%;
  --foreground: 210 40% 98%;
  --primary: 210 40% 98%;
  /* ... */
}
```

## å›½éš›åŒ–å¯¾å¿œ

### 1. è¨€èªè¨­å®š

```typescript
// app/layout.tsx
export default function RootLayout({ children }: Props) {
  return (
    <html lang="ja" suppressHydrationWarning>
      {/* ... */}
    </html>
  );
}
```

### 2. æ—¥ä»˜ãƒ»æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```typescript
// æ—¥æœ¬èªãƒ­ã‚±ãƒ¼ãƒ«å¯¾å¿œ
const formatter = new Intl.NumberFormat("ja-JP", {
  style: "currency",
  currency: "JPY",
});

const dateFormatter = new Intl.DateTimeFormat("ja-JP", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
```
